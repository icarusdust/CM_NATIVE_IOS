workflows:
    ios-workflow:
      name: ios_workflow
      instance_type: mac_mini_m1
      integrations:
        app_store_connect: CM_NEVERCODE
      environment:
        vars:
          XCODE_WORKSPACE: "CM_NATIVE_IOS.xcworkspace" # <-- Put the name of your workspace here.
          # XCODE_PROJECT: "native_ios_app.xcodeproj"
#           XCODE_SCHEME: "native_ios_app" # <-- Put the name of your scheme here.
          BUNDLE_ID: "io.codemagic.mars.CM-NATIVE-IOS" # <-- Put your Bundle Id here.
          XCODE_SCHEME: "CM_NATIVE_IOS" # <-- Put the name of your scheme here.
          APP_ID: "6473636517"
        xcode: 15.0
        ios_signing:
            distribution_type: app_store # or: ad_hoc | development | enterprise
            bundle_identifier: io.codemagic.mars.CM-NATIVE-IOS   
      scripts:
        - name: Pod inst
          script: |
              pod install
        - name: Set up code signing settings on Xcode project
          script: |
             xcode-project use-profiles      
        - name: Increment build number
          script: |
            #!/bin/sh
            cd $CM_BUILD_DIR
            LATEST_BUILD_NUMBER=$(app-store-connect get-latest-testflight-build-number "$APP_ID" --pre-release-version 1.0)
            agvtool new-version -all $(($LATEST_BUILD_NUMBER + 1))  
        - name: Build ipa for distribution
          script: |
            xcode-project build-ipa --workspace "$CM_BUILD_DIR/$XCODE_WORKSPACE" --scheme "$XCODE_SCHEME"
      artifacts:
        - build/ios/ipa/*.ipa
#         - build/ios/ipa/bullet.ipa
        - /tmp/xcodebuild_logs/*.log
#         - $HOME/Library/Developer/Xcode/DerivedData/**/Build/**/*.dSYM
#         - /Users/builder/clone/build/ios_integ/Build/Products/ios_tests.zip
      publishing:
        app_store_connect:
          auth: integration